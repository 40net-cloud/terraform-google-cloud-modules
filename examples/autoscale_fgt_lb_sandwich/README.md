## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >=0.13.0 |
| <a name="requirement_google"></a> [google](#requirement\_google) | ~> 5.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_google"></a> [google](#provider\_google) | 5.43.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_external_lb"></a> [external\_lb](#module\_external\_lb) | ../../modules/gcp/lb | n/a |
| <a name="module_fortigate_asg"></a> [fortigate\_asg](#module\_fortigate\_asg) | ../../modules/fortigate/fgt_asg_with_function | n/a |
| <a name="module_internal_lb"></a> [internal\_lb](#module\_internal\_lb) | ../../modules/gcp/lb | n/a |
| <a name="module_vpc_external"></a> [vpc\_external](#module\_vpc\_external) | ../../modules/gcp/vpc | n/a |
| <a name="module_vpc_internal"></a> [vpc\_internal](#module\_vpc\_internal) | ../../modules/gcp/vpc | n/a |
| <a name="module_vpc_peer"></a> [vpc\_peer](#module\_vpc\_peer) | ../../modules/gcp/vpc_peer | n/a |

## Resources

| Name | Type |
|------|------|
| [google_compute_address.elb_ip](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_address) | resource |
| [google_compute_address.ilb_ip](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_address) | resource |
| [google_compute_route.internal_to_external](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_route) | resource |
| [google_compute_router.router](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_router) | resource |
| [google_compute_router_nat.nat](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_router_nat) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_additional_disk"></a> [additional\_disk](#input\_additional\_disk) | Additional disk for logging.<br><br>Options:<br><br>    - size : (Optional \| number \| default:0) Log disk size (GB) for each FGT. If set to 0, no additional log disk is created.<br>    - type : (Optional \| string \| default:"pd-standard") The Google Compute Engine disk type. Such as "pd-ssd", "local-ssd", "pd-balanced" or "pd-standard".<br><br>Example:<pre>additional_disk = {<br>  size = 30<br>  type = "pd-standard"<br>}</pre> | <pre>object({<br>    size = optional(number, 0)<br>    type = optional(string, "pd-standard")<br>  })</pre> | <pre>{<br>  "size": 0,<br>  "type": "pd-standard"<br>}</pre> | no |
| <a name="input_autoscaler"></a> [autoscaler](#input\_autoscaler) | Auto Scaler parameters. This variable controls when to autoscale and the maximum number of instances.<br>Options:<br><br>    - max\_instances   : (Required \| number) The maximum number of FGT instances.<br>    - min\_instances   : (Optional \| number \| default:2) The minimum number of FGT instances.<br>    - cooldown\_period : (Optional \| number \| default:300) Specify how long (seconds) it takes for FGT to initialize from boot time until it is ready to serve.<br>    - cpu\_utilization : (Optional \| number \| default:0.9) Autoscaling signal. If cpu utilization above this value, google cloud will create new FGT instance.<br><br>Example:<pre>autoscaler = {<br>    max_instances   = 10<br>    min_instances   = 2<br>    cooldown_period = 300<br>    cpu_utilization = 0.9<br>}</pre> | <pre>object({<br>    max_instances   = number<br>    min_instances   = optional(number, 2)<br>    cooldown_period = optional(number, 300)<br>    cpu_utilization = optional(number, 0.9)<br>  })</pre> | n/a | yes |
| <a name="input_cloud_function"></a> [cloud\_function](#input\_cloud\_function) | Parameters for cloud function. The cloud function is used to inject licenses to FGTs,<br>upload user-specified configurations and manage the FGT autoscale group.<br><br>Options:<br><br>    - function\_ip\_range : (Required \| string) Cloud function needs to have its only CIDR ip range ending with "/28", which cannot be used by other resources. Example "10.1.0.0/28".<br>      This IP range subnet cannot be used by other resources, such as VMs, Private Service Connect, or load balancers.<br>    - license\_source : (Optional \| string \| default:"none") The source of license if your image\_type is "byol".<br>        "none" : Don't inject licenses to FGTs.<br>        "file" : Injecting licenses based on license files. All license files should be in license\_file\_folder.<br>        "fortiflex" : Injecting licenses based on FortiFlex. Need to specify the parameter fortiflex if license\_source is "fortiflex".<br>        "file\_fortiflex" : Injecting licenses based on license files first. If all license files are in use, try FortiFlex next.<br>    - license\_file\_folder : (Optional \| string \| default:"./licenses") The folder where all ".lic" license files are located. Default is "./licenses" folder.<br>    - autoscale\_psksecret : (Optional \| string \| default:"psksecret") The secret key used to synchronize information between FortiGates. If not set, the module will randomly generate a 16-character secret key.<br>    - print\_debug\_msg : (Optional \| bool \| default:false) If set to true, the cloud function will print debug messages. You can find these messages in Google Cloud Logs Explorer.<br>    - fortiflex: (Optional \| object) You need to specify this parameter if your license\_source is "fortiflex" or "file\_fortiflex".<br>        - retrieve\_mode : (Optional \| string \| default:"use\_stopped") How to retrieve an existing fortiflex license (entitlement):<br>            "use\_stopped" selects and reactivates a stopped entitlement where the description field is empty;<br>            "use\_active" selects one active and unused entitlement where the description field is empty.<br>        - username : (Reuqired if license\_source is "fortiflex" or "file\_fortiflex" \| string \| default:"") The username of your FortiFlex account.<br>        - password : (Reuqired if license\_source is "fortiflex" or "file\_fortiflex" \| string \| default:"") The password of your FortiFlex account.<br>        - config : (Reuqired if license\_source is "fortiflex" or "file\_fortiflex" \| string \| default:"") The configuration ID of your FortiFlex configuration (product type should be FortiGate-VM).<br>    - service\_config : (Optional \| object) This parameter controls the instance that runs the cloud function.<br>        - max\_instance\_count : (Optional \| number \| default:1) The limit on the maximum number of function instances that may coexist at a given time.<br>        - max\_instance\_request\_concurrency : (Optional \| number \| default:1) Sets the maximum number of concurrent requests that each instance can receive.<br>        - available\_cpu : (Optional \| string \| default:"1") The number of CPUs used in a single container instance.<br>        - available\_memory : (Optional \| string \| default:"1G") The amount of memory available for a function. Supported units are k, M, G, Mi, Gi. If no unit is supplied the value is interpreted as bytes.<br>        - timeout\_seconds : (Optional \| number \| default:240) The function execution timeout. Execution is considered failed and can be terminated if the function is not completed at the end of the timeout period.<br><br>Example:<pre>cloud_function = {<br>  function_ip_range      = "10.1.0.0/28"<br>  license_source         = "file_fortiflex" # "none", "fortiflex", "file", "file_fortiflex"<br>  license_file_folder    = "./licenses"<br>  autoscale_psksecret    = "psksecret"<br>  # Specify fortiflex parameters if license_source is "fortiflex" or "file_fortiflex"<br>  fortiflex = {<br>    retrieve_mode = "use_activate"<br>    username      = "Your fortiflex username"<br>    password      = "Your fortiflex password"<br>    config        = "Your fortiflex configuration ID"<br>  }<br>  # Parameters of google cloud function.<br>  service_config = {<br>    max_instance_request_concurrency = 2<br>    timeout_seconds                  = 360<br>  }<br>}</pre> | <pre>object({<br>    function_ip_range   = string<br>    license_source      = optional(string, "none")<br>    license_file_folder = optional(string, "./licenses")<br>    autoscale_psksecret = optional(string, "psksecret")<br>    print_debug_msg     = optional(bool, false)<br>    fortiflex = optional(object({<br>      retrieve_mode = optional(string, "use_stopped")<br>      username      = optional(string, "")<br>      password      = optional(string, "")<br>      config        = optional(string, "")<br>    }), {})<br>    service_config = optional(object({<br>      max_instance_count               = optional(number, 1)<br>      max_instance_request_concurrency = optional(number, 1)<br>      available_cpu                    = optional(string, "1")<br>      available_memory                 = optional(string, "1G")<br>      timeout_seconds                  = optional(number, 240)<br>    }), {})<br>  })</pre> | n/a | yes |
| <a name="input_config_file"></a> [config\_file](#input\_config\_file) | Additional FGT configuration script file. | `string` | `""` | no |
| <a name="input_config_script"></a> [config\_script](#input\_config\_script) | Additional FGT configuration script. | `string` | `""` | no |
| <a name="input_external_subnet"></a> [external\_subnet](#input\_external\_subnet) | The CIDR of the external VPC for this project. This IP range is used only for FGTs. | `string` | n/a | yes |
| <a name="input_fgt_has_public_ip"></a> [fgt\_has\_public\_ip](#input\_fgt\_has\_public\_ip) | If set to true, port1 of all FGTs will have a public IP. | `bool` | `false` | no |
| <a name="input_fgt_password"></a> [fgt\_password](#input\_fgt\_password) | Password for all FGTs (user name is admin). If no password is set, the module will randomly generate a 16-character password. | `string` | `""` | no |
| <a name="input_image_type"></a> [image\_type](#input\_image\_type) | FGT Image type.<br>Use the following command to check all FGT image type:<br>"gcloud compute images list --project=fortigcp-project-001 --filter="family:fortigate*" --format="table[no-heading](family)" \| sort \| uniq"<br><br>fortigate-74-byol : FortiGate 7.4, bring your own licenses.<br><br>fortigate-74-payg : FortiGate 7.4, don't need to provide licenses, pay as you go. | `string` | `"fortigate-74-byol"` | no |
| <a name="input_internal_subnet"></a> [internal\_subnet](#input\_internal\_subnet) | The CIDR of the internal VPC for this project. This IP range is used only for FGTs and internal load balancer. | `string` | n/a | yes |
| <a name="input_load_balancer"></a> [load\_balancer](#input\_load\_balancer) | Parameters for external and internal load balancers.<br><br>Options:<br><br>    - health\_check\_port : (Optional \| number \| default:8008) The port to be used for health check.<br>    - internal\_lb : (Optional \| object) The parameters of internal load balancer.<br>        - front\_end\_ip : (Optional \| string \| default:"") Front end IP of the internal load balancer. It should be in the internal subnet IP range. Set by the API if undefined.<br>        - frontend\_protocol : (Optional \| string \| default:"TCP") Protocol of the front-end forwarding rule. Valid options are TCP, UDP, ESP, AH, SCTP, ICMP and L3\_DEFAULT.<br>        - backend\_protocol : (Optional \| string \| default:"TCP") The protocol the load balancer uses to communicate with the backend. Valid options are HTTP, HTTPS, HTTP2, SSL, TCP, UDP, GRPC, UNSPECIFIED.<br>    - external\_lb : (Optional \| object) The parameters of external load balancer.<br>        - frontend\_protocol : (Optional \| string \| default:"TCP") Protocol of the front-end forwarding rule. Valid options are TCP, UDP, ESP, AH, SCTP, ICMP and L3\_DEFAULT.<br>        - backend\_protocol : (Optional \| string \| default:"TCP") The protocol the load balancer uses to communicate with the backend. Valid options are HTTP, HTTPS, HTTP2, SSL, TCP, UDP, GRPC, UNSPECIFIED.<br><br>Example:<pre>load_balancer = {<br>  health_check_port = 8008<br>  internal_lb = {<br>    front_end_ip      = "10.0.1.100"<br>    frontend_protocol = "TCP"<br>    backend_protocol  = "TCP"<br>  }<br>  external_lb = {<br>    frontend_protocol = "TCP"<br>    backend_protocol  = "TCP"<br>  }<br>}</pre> | <pre>object({<br>    health_check_port = optional(number, 8008)<br>    internal_lb = optional(object({<br>      front_end_ip      = optional(string, "")<br>      frontend_protocol = optional(string, "TCP")<br>      backend_protocol  = optional(string, "TCP")<br>      }), {}<br>    )<br>    external_lb = optional(object({<br>      frontend_protocol = optional(string, "TCP")<br>      backend_protocol  = optional(string, "TCP")<br>      }), {}<br>    )<br>  })</pre> | `{}` | no |
| <a name="input_machine_type"></a> [machine\_type](#input\_machine\_type) | The Virtual Machine type to deploy FGT. Example of predefined type: n1-standard-4, n2-standard-8, ...<br><br>Custom machine types can be formatted as custom-NUMBER\_OF\_CPUS-AMOUNT\_OF\_MEMORY\_MB,<br>e.g. custom-6-20480 for 6 vCPU and 20GB of RAM.<br><br>There is a limit of 6.5 GB per CPU unless you add extended memory. You must do this explicitly by adding the suffix -ext,<br>e.g. custom-2-15360-ext for 2 vCPU and 15 GB of memory. | `string` | n/a | yes |
| <a name="input_prefix"></a> [prefix](#input\_prefix) | Prefix of the objects in this project. It should be unique to avoid name conflict between projects. | `string` | n/a | yes |
| <a name="input_project"></a> [project](#input\_project) | Your GCP project name. | `string` | n/a | yes |
| <a name="input_protected_vpc"></a> [protected\_vpc](#input\_protected\_vpc) | List of your existing VPCs. These VPCs should not have a default route ("0.0.0.0/0"), otherwise their traffic will not be sent to the FGT.<br><br>If specified, your VPC will be peered with the this project's internal VPC.<br>And outbound and inbound traffic from these VPCs will first go through the FGTs.<br><br>Options:<br><br>  - name : (Required \| string) Name of your existing VPC. | <pre>list(object({<br>    name = string<br>  }))</pre> | `[]` | no |
| <a name="input_region"></a> [region](#input\_region) | The region to deploy the project. | `string` | n/a | yes |
| <a name="input_zone"></a> [zone](#input\_zone) | The zone to deploy the project. | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_autoscale_psksecret"></a> [autoscale\_psksecret](#output\_autoscale\_psksecret) | The secret key used to synchronize information between FortiGates. |
| <a name="output_fgt_password"></a> [fgt\_password](#output\_fgt\_password) | Password for all FGTs. |
| <a name="output_fgt_username"></a> [fgt\_username](#output\_fgt\_username) | Default username for all FGTs. |
| <a name="output_vpc_external"></a> [vpc\_external](#output\_vpc\_external) | External VPC. |
| <a name="output_vpc_internal"></a> [vpc\_internal](#output\_vpc\_internal) | External VPC. |
